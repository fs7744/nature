use t::nature 'no_plan';

repeat_each(1);
log_level('info');
no_long_string();
no_root_location();
run_tests();


__DATA__

=== request get_http_version
--- config
location /t {
    content_by_lua_block {
        local req = require("nature.core.request")
        ngx.say(req.get_http_version())
    }
}
--- request
GET /t
--- error_code: 200
--- response_body
1.1

=== request get_host
--- config
location /t {
    content_by_lua_block {
        local context = require("nature.core.context")
        local req = require("nature.core.request")
        local ctx = context.new_api_context()
        ngx.say(req.get_host(ctx))
    }
}
--- request
GET /t
--- more_headers
HOST: 10.0.0.1
--- error_code: 200
--- response_body
10.0.0.1
--- no_error_log
[error]

=== request get_header
--- config
location /t {
    content_by_lua_block {
        local context = require("nature.core.context")
        local req = require("nature.core.request")
        local ctx = context.new_api_context()
        req.get_header(ctx, 'a')
        ngx.say(req.get_header(ctx, 'a'))
    }
}
--- request
GET /t
--- more_headers
a: whereisa
--- error_code: 200
--- response_body
whereisa
--- no_error_log
[error]

=== request set_header
--- config
location /t {
    content_by_lua_block {
        local context = require("nature.core.context")
        local req = require("nature.core.request")
        local ctx = context.new_api_context()
        req.set_header(ctx, 'a', 'whereb')
        req.get_header(ctx, 'a')
        ngx.say(req.get_header(ctx, 'a'))
    }
}
--- request
GET /t
--- error_code: 200
--- response_body
whereb
--- no_error_log
[error]

=== request get_uri_args
--- config
location /t {
    content_by_lua_block {
        local json = require("nature.core.json")
        local context = require("nature.core.context")
        local req = require("nature.core.request")
        local ctx = context.new_api_context()
        req.get_uri_args(ctx)
        ngx.say(json.encode(req.get_uri_args(ctx)))
    }
}
--- request
GET /t?s=d
--- error_code: 200
--- response_body
{"s":"d"}
--- no_error_log
[error]

=== request set_uri_args
--- config
location /t {
    content_by_lua_block {
        local json = require("nature.core.json")
        local context = require("nature.core.context")
        local req = require("nature.core.request")
        local ctx = context.new_api_context()
        req.get_uri_args(ctx)
        req.set_uri_args(ctx, {s='d'})
        req.get_uri_args(ctx)
        ngx.say(json.encode(req.get_uri_args(ctx)))
    }
}
--- request
GET /t?a=c
--- error_code: 200
--- response_body
{"s":"d"}
--- no_error_log
[error]

=== request set_var
--- config
set $d '';
location /t {
    content_by_lua_block {
        local json = require("nature.core.json")
        local context = require("nature.core.context")
        local req = require("nature.core.request")
        local ctx = context.new_api_context()
        context.register_var_name('d')
        req.set_var(ctx, 'd', 'd')
        ngx.say(ngx.var['d']..ctx.var['d'])
    }
}
--- request
GET /t?a=c
--- error_code: 200
--- response_body
dd
--- no_error_log
[error]

=== request get_body without max_size
--- config
client_body_buffer_size 1k;
location /t {
    content_by_lua_block {
        local log = require("nature.core.log")
        local json = require("nature.core.json")
        local context = require("nature.core.context")
        local req = require("nature.core.request")
        local ctx = context.new_api_context()
        local body,err = req.get_body(ctx)
        if body then
            local data = json.decode(body)
            data['dd'] = data['dd']..'d'
            ngx.say(json.encode(data))
        else
           log.error(err)
        end
    }
}
--- log_level: debug
--- request
GET /t?a=c
{"dd":"c"}
--- error_code: 200
--- response_body
{"dd":"cd"}
--- no_error_log
[error]

=== request get_body without max_size
--- config
client_body_buffer_size 1k;
location /t {
    content_by_lua_block {
        local log = require("nature.core.log")
        local json = require("nature.core.json")
        local context = require("nature.core.context")
        local req = require("nature.core.request")
        local ctx = context.new_api_context()
        local body,err = req.get_body(ctx)
        if body then
            local data = json.decode(body)
            data['dd'] = data['dd']..'d'
            ngx.say(json.encode(data))
        else
           log.error(err)
        end
    }
}
--- log_level: debug
--- request
POST /tT?a=c
{"dd":"cSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"}
--- error_code: 200
--- response_body
{"dd":"cSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaad"}

=== request get_body with max_size less than 200
--- config
client_body_buffer_size 1k;
location /t {
    content_by_lua_block {
        local log = require("nature.core.log")
        local json = require("nature.core.json")
        local context = require("nature.core.context")
        local req = require("nature.core.request")
        local ctx = context.new_api_context()
        local body,err = req.get_body(ctx, 200)
        if body then
            local data = json.decode(body)
            data['dd'] = data['dd']..'d'
            ngx.say(json.encode(data))
        else
           log.error(err)
        end
    }
}
--- log_level: debug
--- request
GET /t?a=c
{"dd":"c"}
--- error_code: 200
--- response_body
{"dd":"cd"}
--- no_error_log
[error]

=== request get_body with max_size greater than 200
--- config
client_body_buffer_size 1k;
location /t {
    content_by_lua_block {
        local log = require("nature.core.log")
        local json = require("nature.core.json")
        local context = require("nature.core.context")
        local req = require("nature.core.request")
        local ctx = context.new_api_context()
        local body,err = req.get_body(ctx, 200)
        if body then
            local data = json.decode(body)
            data['dd'] = data['dd']..'d'
            ngx.say(json.encode(data))
        else
           log.error(err)
        end
    }
}
--- log_level: debug
--- request
POST /tT?a=c
{"dd":"cSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSADADAFAFVAAAAAAADFADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDFLJSIGSJFPOIAJFPADFJOPAODJFPAIGJAPFJJJJJJJJJJJJJJJJJJJJADPIJGOIAGJAPOFDAJFPAIFJAIOFJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOADHGFADGHADFOADFHADDDDDDDDDDDDDDDDDDDDAHIUDFASODHAOSDIHAOSDIHAOSDAOHFSAHFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAUIDHGAUDGHADIUGHAIUFUHIAGHFIUGGHADIUFGAIUFAUIDFYGAAAAAAAAAAAAAUHFDSUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUAIDUFGHAIVIIIIIIIIIIIIIIIIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVIVsssssdddddddddddddddddddddddddddddddddddddddddddddddddddddaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"}
--- error_code: 200
--- response_body
--- error_log
request size 8417 is greater than the maximum size 200 allowed

=== request get_body with max_size greater than 200 and not req body file
--- config
client_body_buffer_size 1k;
location /tt {
    content_by_lua_block {
        local log = require("nature.core.log")
        local json = require("nature.core.json")
        local context = require("nature.core.context")
        local req = require("nature.core.request")
        local ctx = context.new_api_context()
        local body,err = req.get_body(ctx, 200)
        if body then
            local data = json.decode(body)
            data['dd'] = data['dd']..'d'
            ngx.say(json.encode(data))
        else
           log.error(err)
        end
    }
}
--- log_level: debug
--- request
POST /tt?a=c
{"dd":"cSDDDSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSASSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSASSSSSSSSSSSSSSSSSSSSSSSSSDSASSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSDSASSSSSSSSSSSSSSSDSA"}
--- error_code: 200
--- response_body
--- error_log
request size 221 is greater than the maximum size 200 allowed
